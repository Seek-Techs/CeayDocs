

Rule:
ðŸ‘‰ utils/ = pure business logic
ðŸ‘‰ api/ = HTTP + validation + auth
ðŸ‘‰ app.py = UI only

ðŸ”’ Golden Rules (memorize these)

Read UploadFile exactly once

Pass bytes to utils, not UploadFile

Utils never call .read()

API layer handles async, utils stay sync

Rule (mandatory):

All utils must accept bytes only.
All routers must be responsible for reading the file exactly once.

No exceptions.

FILE FLOW RULE (THIS FIXES YOUR EMPTY FILE ERRORS)

SYSTEM LAW:
ðŸ‘‰ Everything inside core & utils uses BYTES, not file objects

ðŸŸ¢ Core Layer (core/)

Your competitive advantage lives here.

Responsibilities:

Drawing classification

Engineering extraction

Dimension parsing

Scale detection

View identification


ðŸ”µ Services Layer (services/)

This is your brain coordinator.

Example:

Upload PDF
â†’ classify
â†’ extract text/images
â†’ parse engineering data
â†’ return structured result


Services decide WHAT HAPPENS, not HOW.


ðŸ”´ FastAPI Routers (api/routers)

DO NOT process files here.

Only:

Receive request

Validate

Call services/*

Return response



âœ… PHASE 2.1 â€” ARCHITECTURE FIRST (FOUNDATION)
1. HIGH-LEVEL SYSTEM ARCHITECTURE
CeayDocs
â”‚
â”œâ”€â”€ api/                # FastAPI (public interface)
â”‚   â”œâ”€â”€ main.py
â”‚   â””â”€â”€ routers/
â”‚       â”œâ”€â”€ drawings.py
â”‚       â”œâ”€â”€ convert.py
â”‚       â”œâ”€â”€ split.py
â”‚       â””â”€â”€ health.py
â”‚
â”œâ”€â”€ core/               # Domain intelligence (AEC logic)
â”‚   â”œâ”€â”€ classify.py
â”‚   â”œâ”€â”€ extract.py
â”‚   â”œâ”€â”€ parse.py
â”‚   â””â”€â”€ schemas.py
â”‚
â”œâ”€â”€ utils/              # Low-level technical helpers
â”‚   â”œâ”€â”€ files.py
â”‚   â”œâ”€â”€ images.py
â”‚   â”œâ”€â”€ pdf.py
â”‚   â””â”€â”€ cleanup.py
â”‚
â”œâ”€â”€ services/           # Orchestration layer
â”‚   â”œâ”€â”€ analyzer.py
â”‚   â””â”€â”€ exporter.py
â”‚   â””â”€â”€ drawing_index.py
â”‚
â”œâ”€â”€ data/
â”‚   â””â”€â”€ temp/           # Runtime temp files (gitignored)
â”‚
â”œâ”€â”€ tests/              # Unit + integration tests
â”‚
â”œâ”€â”€ app.py              # Streamlit UI (consumer)
â”œâ”€â”€ requirements.txt
â””â”€â”€ README.md